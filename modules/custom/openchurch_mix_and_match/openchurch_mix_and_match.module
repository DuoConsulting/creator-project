<?php

/**
 * Implementation of form_alter()
 */
function openchurch_mix_and_match_form_alter(&$form, &$form_state, $form_id){
  if ($form_id == 'system_theme_settings'){
    $form['#submit'][] = 'openchurch_mix_and_match_submit';
  }

  if ($form_id == 'system_themes_form'){
    $form['#submit'][] = 'openchurch_mix_and_match_themes_submit';
  }
}

/**
 * Theme submit handler
 */
function openchurch_mix_and_match_themes_submit($form, &$form_state){

  /**
   * Pre-initialize a M&M preset the first time this theme is enabled
   */
  if ($form_state['values']['status']['openchurch_mm'] OR $form_state['values']['theme_default'] == 'openchurch_mm'){
    $theme_settings_exist = db_result(db_query("SELECT value FROM {variable} WHERE name = 'skinr_openchurch_mm'"));

    if (!$theme_settings_exist){
      $blue_gray_white = 'a:42:{s:11:"toggle_logo";i:1;s:11:"toggle_name";i:1;s:13:"toggle_slogan";i:0;s:24:"toggle_node_user_picture";i:0;s:27:"toggle_comment_user_picture";i:0;s:13:"toggle_search";i:1;s:14:"toggle_favicon";i:1;s:20:"toggle_primary_links";i:1;s:22:"toggle_secondary_links";i:1;s:12:"default_logo";i:1;s:9:"logo_path";s:0:"";s:11:"logo_upload";s:0:"";s:15:"default_favicon";i:1;s:12:"favicon_path";s:0:"";s:14:"favicon_upload";s:0:"";s:10:"theme_grid";s:10:"grid12-960";s:16:"fluid_grid_width";s:9:"fluid-100";s:14:"sidebar_layout";s:18:"sidebars-both-last";s:19:"sidebar_first_width";s:1:"2";s:18:"sidebar_last_width";s:1:"3";s:10:"theme_font";s:4:"none";s:15:"theme_font_size";s:12:"font-size-12";s:21:"primary_menu_dropdown";i:1;s:18:"breadcrumb_display";i:1;s:14:"search_snippet";i:1;s:16:"search_info_type";i:1;s:16:"search_info_user";i:1;s:16:"search_info_date";i:1;s:19:"search_info_comment";i:1;s:18:"search_info_upload";i:1;s:24:"user_notverified_display";i:1;s:17:"block_config_link";i:1;s:9:"grid_mask";i:0;s:16:"rebuild_registry";i:0;s:13:"fix_css_limit";i:0;s:21:"mix_and_match_body_bg";s:4:"blue";s:21:"mix_and_match_page_bg";s:13:"white-page-bg";s:26:"mix_and_match_accent_color";s:12:"blue-accents";s:26:"mix_and_match_footer_color";s:14:"default-footer";s:26:"mix_and_match_header_color";s:13:"black-headers";s:24:"mix_and_match_link_color";s:10:"blue-links";s:21:"mix_and_match_corners";s:15:"round-corners-3";}';
      db_query('REPLACE INTO {variable} VALUES ("theme_openchurch_mm_settings", "%s")', $blue_gray_white);

      _openchurch_mix_and_match_update_preset_blue_gray_white();
    }
  }
}

/**
 * Openchurch MM submit
 */
function openchurch_mix_and_match_submit($form, &$form_state){

  $mm_preset = $form_state['values']['openchurch_mm_color_preset'];

  if (!$mm_preset) return;//skip

  @db_query("DELETE FROM {variable} WHERE name = 'skinr_openchurch_mm'");

  switch ($mm_preset){//load skinr settings
    case 'blue-gray-white':
      _openchurch_mix_and_match_update_preset_blue_gray_white();
      break;
    case 'blue-green-white':
      _openchurch_mix_and_match_update_preset_blue_green_white();
      break;
    case 'green-black':
      _openchurch_mix_and_match_update_preset_green_black();
      break;
    case 'blue-white':
      _openchurch_mix_and_match_update_preset_blue_white();
      break;
    case 'gray-black':
      _openchurch_mix_and_match_update_preset_gray_black();
      break;
    case 'green-white':
      _openchurch_mix_and_match_update_preset_green_white();
      break;
    case 'orange-black':
      _openchurch_mix_and_match_update_preset_orange_black();
      break;
    case 'red-white':
      _openchurch_mix_and_match_update_preset_red_white();
      break;
  }
}

/**
 * Blue Gray White
 */
function _openchurch_mix_and_match_update_preset_blue_gray_white(){
  $skinr = array (
    'block' =>
    array (
      'openchurch_block-sidebar_block_rt2' =>
      array (
        'background-color' => 'gray-background',
        '_additional' => 'view-map-directions',
      ),
      'openchurch_block-global_bottom_block3' =>
      array (
        'grid12-width' => 'grid12-4',
        'background-color' => 'lt-blue-background',
        'header-background' => 'blue-header',
        'title-color' => 'white-title',
        'fusion-equal-heights' =>
        array (
          'equal-heights' => 'equal-heights',
        ),
      ),
      'openchurch_block-global_bottom_block2' =>
      array (
        'grid12-width' => 'grid12-4',
        'background-color' => 'lt-blue-background',
        'header-background' => 'blue-header',
        'title-color' => 'white-title',
        'fusion-equal-heights' =>
        array (
          'equal-heights' => 'equal-heights',
        ),
      ),
      'openchurch_block-global_bottom_block1' =>
      array (
        'grid12-width' => 'grid12-4',
        'background-color' => 'lt-blue-background',
        'header-background' => 'blue-header',
        'title-color' => 'white-title',
        'fusion-equal-heights' =>
        array (
          'equal-heights' => 'equal-heights',
        ),
      ),
      'views-2f0b8c3051cf70fc0070adce0aa40ff8' =>
      array (
        'background-color' => 'lt-blue-background',
        'header-background' => 'blue-header',
        'title-color' => 'white-title',
      ),
      'openchurch_block-sidebar_block_rt1' =>
      array (
        'background-color' => 'gray-background',
        'title-color' => 'blue-title',
      ),
      'views-794f38e8ce669fc0643cfeb6da701af6' =>
      array (
        'background-color' => 'lt-blue-background',
        'header-background' => 'blue-header',
        'title-color' => 'white-title',
      ),
    ),
  );

  variable_set('skinr_openchurch_mm', $skinr);
}

/**
 * Blue Green White
 */
function _openchurch_mix_and_match_update_preset_blue_green_white(){
  $skinr = array (
    'block' =>
    array (
      'openchurch_block-sidebar_block_rt2' =>
      array (
        'background-color' => 'lt-blue-background',
        'link-color' => 'block-blue-links',
        '_additional' => 'view-map-directions',
      ),
      'openchurch_block-global_bottom_block3' =>
      array (
        'grid12-width' => 'grid12-4',
        'background-color' => 'blue-background',
        'header-background' => 'blue-header',
        'title-color' => 'white-title',
        'link-color' => 'block-white-links',
        'fusion-equal-heights' =>
        array (
          'equal-heights' => 'equal-heights',
        ),
      ),
      'openchurch_block-global_bottom_block2' =>
      array (
        'grid12-width' => 'grid12-4',
        'background-color' => 'green-background',
        'header-background' => 'green-header',
        'title-color' => 'white-title',
        'link-color' => 'block-white-links',
        'fusion-equal-heights' =>
        array (
          'equal-heights' => 'equal-heights',
        ),
      ),
      'openchurch_block-global_bottom_block1' =>
      array (
        'grid12-width' => 'grid12-4',
        'background-color' => 'blue-background',
        'header-background' => 'blue-header',
        'title-color' => 'white-title',
        'link-color' => 'block-white-links',
        'fusion-equal-heights' =>
        array (
          'equal-heights' => 'equal-heights',
        ),
      ),
      'views-2f0b8c3051cf70fc0070adce0aa40ff8' =>
      array (
        'background-color' => 'lt-green-background',
        'title-color' => 'black-title',
        'link-color' => 'block-blue-links',
      ),
      'openchurch_block-sidebar_block_rt1' =>
      array (
        'background-color' => 'lt-blue-background',
        'link-color' => 'block-blue-links',
      ),
      'views-794f38e8ce669fc0643cfeb6da701af6' =>
      array (
        'background-color' => 'lt-green-background',
        'title-color' => 'black-title',
        'link-color' => 'block-blue-links',
      ),
    ),
  );

  variable_set('skinr_openchurch_mm', $skinr);
}

/**
 * Green Black
 */
function _openchurch_mix_and_match_update_preset_green_black(){

  $skinr = array (
    'block' =>
    array (
      'openchurch_block-sidebar_block_rt2' =>
      array (
        'background-color' => 'green-background',
        'link-color' => 'block-white-links',
        '_additional' => 'view-map-directions',
      ),
      'openchurch_block-global_bottom_block3' =>
      array (
        'grid12-width' => 'grid12-4',
        'background-color' => 'med-gray-background',
        'fusion-equal-heights' =>
        array (
          'equal-heights' => 'equal-heights',
        ),
      ),
      'openchurch_block-global_bottom_block2' =>
      array (
        'grid12-width' => 'grid12-4',
        'background-color' => 'med-gray-background',
        'fusion-equal-heights' =>
        array (
          'equal-heights' => 'equal-heights',
        ),
      ),
      'openchurch_block-global_bottom_block1' =>
      array (
        'grid12-width' => 'grid12-4',
        'background-color' => 'med-gray-background',
        'fusion-equal-heights' =>
        array (
          'equal-heights' => 'equal-heights',
        ),
      ),
      'views-2f0b8c3051cf70fc0070adce0aa40ff8' =>
      array (
        'background-color' => 'med-gray-background',
      ),
      'openchurch_block-sidebar_block_rt1' =>
      array (
        'background-color' => 'lt-green-background',
        'title-color' => 'gray-title',
        'link-color' => 'block-gray-links',
      ),
      'views-794f38e8ce669fc0643cfeb6da701af6' =>
      array (
        'background-color' => 'med-gray-background',
      ),
    ),
  );

  variable_set('skinr_openchurch_mm', $skinr);
}

/**
 * Blue White
 */
function _openchurch_mix_and_match_update_preset_blue_white(){
  $skinr = array (
    'block' =>
    array (
      'openchurch_block-sidebar_block_rt2' =>
      array (
        'background-color' => 'gray-background',
        '_additional' => 'view-map-directions',
      ),
      'openchurch_block-global_bottom_block3' =>
      array (
        'grid12-width' => 'grid12-4',
        'header-background' => 'gray-header',
        'fusion-equal-heights' =>
        array (
          'equal-heights' => 'equal-heights',
        ),
      ),
      'openchurch_block-global_bottom_block2' =>
      array (
        'grid12-width' => 'grid12-4',
        'header-background' => 'gray-header',
        'fusion-equal-heights' =>
        array (
          'equal-heights' => 'equal-heights',
        ),
      ),
      'openchurch_block-global_bottom_block1' =>
      array (
        'grid12-width' => 'grid12-4',
        'header-background' => 'gray-header',
        'fusion-equal-heights' =>
        array (
          'equal-heights' => 'equal-heights',
        ),
      ),
    ),
  );

  variable_set('skinr_openchurch_mm', $skinr);
}

/**
 * Gray Black
 */
function _openchurch_mix_and_match_update_preset_gray_black(){

  $skinr = array (
    'block' =>
    array (
      'openchurch_block-sidebar_block_rt2' =>
      array (
        'background-color' => 'dk-gray-background',
        'link-color' => 'block-white-links',
        '_additional' => 'view-map-directions',
      ),
      'openchurch_block-global_bottom_block3' =>
      array (
        'grid12-width' => 'grid12-4',
        'background-color' => 'dk-gray-background',
        'header-background' => 'black-header',
        'title-color' => 'white-title',
        'fusion-equal-heights' =>
        array (
          'equal-heights' => 'equal-heights',
        ),
      ),
      'openchurch_block-global_bottom_block2' =>
      array (
        'grid12-width' => 'grid12-4',
        'background-color' => 'dk-gray-background',
        'header-background' => 'black-header',
        'title-color' => 'white-title',
        'fusion-equal-heights' =>
        array (
          'equal-heights' => 'equal-heights',
        ),
      ),
      'openchurch_block-global_bottom_block1' =>
      array (
        'grid12-width' => 'grid12-4',
        'background-color' => 'dk-gray-background',
        'header-background' => 'black-header',
        'title-color' => 'white-title',
        'fusion-equal-heights' =>
        array (
          'equal-heights' => 'equal-heights',
        ),
      ),
      'openchurch_block-sidebar_block_rt1' =>
      array (
        'background-color' => 'dk-gray-background',
        'header-background' => 'black-header',
        'title-color' => 'white-title',
      ),
    ),
  );

  variable_set('skinr_openchurch_mm', $skinr);
}

/**
 * Green White
 */
function _openchurch_mix_and_match_update_preset_green_white(){
  $skinr = array (
    'block' =>
    array (
      'openchurch_block-sidebar_block_rt2' =>
      array (
        'background-color' => 'gray-background',
        '_additional' => 'view-map-directions',
      ),
      'openchurch_block-global_bottom_block3' =>
      array (
        'grid12-width' => 'grid12-4',
        'header-background' => 'green-header',
        'fusion-equal-heights' =>
        array (
          'equal-heights' => 'equal-heights',
        ),
      ),
      'openchurch_block-global_bottom_block2' =>
      array (
        'grid12-width' => 'grid12-4',
        'header-background' => 'green-header',
        'fusion-equal-heights' =>
        array (
          'equal-heights' => 'equal-heights',
        ),
      ),
      'openchurch_block-global_bottom_block1' =>
      array (
        'grid12-width' => 'grid12-4',
        'header-background' => 'green-header',
        'fusion-equal-heights' =>
        array (
          'equal-heights' => 'equal-heights',
        ),
      ),
      'views-2f0b8c3051cf70fc0070adce0aa40ff8' =>
      array (
        'background-color' => 'lt-green-background',
        'header-background' => 'green-header',
        'title-color' => 'white-title',
      ),
      'openchurch_block-sidebar_block_rt1' =>
      array (
        'background-color' => 'gray-background',
        'header-background' => 'gray-header',
      ),
      'views-794f38e8ce669fc0643cfeb6da701af6' =>
      array (
        'background-color' => 'lt-green-background',
        'header-background' => 'green-header',
        'title-color' => 'white-title',
      ),
    ),
  );

  variable_set('skinr_openchurch_mm', $skinr);
}

/**
 * Orange Black
 */
function _openchurch_mix_and_match_update_preset_orange_black(){
  $skinr = array (
    'block' =>
    array (
      'openchurch_block-sidebar_block_rt2' =>
      array (
        'background-color' => 'lt-orange-background',
        'link-color' => 'block-black-links',
        '_additional' => 'view-map-directions',
      ),
      'openchurch_block-global_bottom_block3' =>
      array (
        'grid12-width' => 'grid12-4',
        'background-color' => 'dk-gray-background',
        'title-color' => 'white-title',
        'fusion-equal-heights' =>
        array (
          'equal-heights' => 'equal-heights',
        ),
      ),
      'openchurch_block-global_bottom_block2' =>
      array (
        'grid12-width' => 'grid12-4',
        'background-color' => 'dk-gray-background',
        'title-color' => 'white-title',

        'fusion-equal-heights' =>
        array (
          'equal-heights' => 'equal-heights',
        ),
      ),
      'openchurch_block-global_bottom_block1' =>
      array (
        'grid12-width' => 'grid12-4',
        'background-color' => 'dk-gray-background',
        'title-color' => 'white-title',
        'fusion-equal-heights' =>
        array (
          'equal-heights' => 'equal-heights',
        ),
      ),
      'openchurch_block-sidebar_block_rt1' =>
      array (
        'background-color' => 'black-background',
        'title-color' => 'orange-title',
      ),
      'views-2f0b8c3051cf70fc0070adce0aa40ff8' =>
      array (
        'background-color' => 'dk-gray-background',
        'title-color' => 'white-title',
        'link-color' => 'block-white-links',
      ),
      'views-794f38e8ce669fc0643cfeb6da701af6' =>
      array (
        'background-color' => 'dk-gray-background',
        'title-color' => 'white-title',
        'link-color' => 'block-white-links',
      ),
    ),
  );

  variable_set('skinr_openchurch_mm', $skinr);
}

/**
 * Red White
 */
function _openchurch_mix_and_match_update_preset_red_white(){
  $skinr = array (
    'block' =>
    array (
      'openchurch_block-sidebar_block_rt2' =>
      array (
        'background-color' => 'red-background',
        'link-color' => 'block-white-links',
        '_additional' => 'view-map-directions',
      ),
      'openchurch_block-global_bottom_block3' =>
      array (
        'grid12-width' => 'grid12-4',
        'header-background' => 'red-header',
        'title-color' => 'white-title',
        'fusion-equal-heights' =>
        array (
          'equal-heights' => 'equal-heights',
        ),
      ),
      'openchurch_block-global_bottom_block2' =>
      array (
        'grid12-width' => 'grid12-4',
        'header-background' => 'red-header',
        'title-color' => 'white-title',
        'fusion-equal-heights' =>
        array (
          'equal-heights' => 'equal-heights',
        ),
      ),
      'openchurch_block-global_bottom_block1' =>
      array (
        'grid12-width' => 'grid12-4',
        'header-background' => 'red-header',
        'title-color' => 'white-title',
        'fusion-equal-heights' =>
        array (
          'equal-heights' => 'equal-heights',
        ),
      ),
      'openchurch_block-sidebar_block_rt1' =>
      array (
        'background-color' => 'gray-background',
        'header-background' => 'red-header',
        'title-color' => 'white-title',
      ),
    ),
  );

  variable_set('skinr_openchurch_mm', $skinr);
}